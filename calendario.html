<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Calendário Corporativo – Agenda Areia Ana</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg: #050814;
      --bg-card: #0b1020;
      --bg-card-soft: #101629;
      --accent: #ff7a1a;       /* Laranja do cabeçalho */
      --accent-soft: #ff9b4a;
      --text: #f5f7ff;
      --text-soft: #c2c7ff;
      --border-soft: #151a2b;
      --feriado: #4f4f4f;      /* Cinza mais escuro pro feriado */
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: radial-gradient(circle at top, #151821 0, #050814 45%, #02030a 100%);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 24px;
    }

    .wrapper {
      width: 100%;
      max-width: 1280px;
    }

    .card {
      background: linear-gradient(145deg, #060a17 0, #050814 40%, #050814 60%, #060a17 100%);
      border-radius: 24px;
      padding: 24px 24px 20px;
      box-shadow:
        0 32px 80px rgba(0, 0, 0, 0.72),
        0 0 0 1px rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.03);
    }

    .card-header {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .title-block h1 {
      font-size: 1.4rem;
      margin: 0;
    }

    .title-block p {
      margin: 4px 0 0;
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .controls label {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-right: 4px;
    }

    .controls select {
      background: #080d1a;
      border: 1px solid var(--border-soft);
      color: var(--text);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      outline: none;
    }

    .controls select:focus {
      border-color: var(--accent-soft);
      box-shadow: 0 0 0 1px rgba(255, 122, 26, 0.35);
    }

    /* Navegação mês */
    .month-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
      margin-top: 4px;
    }

    .month-nav button {
      background: #080d1a;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      color: var(--text-soft);
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1rem;
      padding: 0;
    }

    .month-nav button:hover {
      border-color: var(--accent-soft);
      color: var(--accent-soft);
    }

    .month-nav span {
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    /* Calendário mensal (principal) */
    .calendar-table {
      width: 100%;
      border-collapse: collapse;
      background: #050814;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.02);
    }

    .calendar-table thead {
      background: var(--accent);   /* laranja */
      color: #1b1208;
    }

    .calendar-table th,
    .calendar-table td {
      padding: 8px;
      text-align: center;
      font-size: 0.8rem;
      border-bottom: 1px solid var(--border-soft);
      border-right: 1px solid var(--border-soft);
    }

    .calendar-table th:first-child,
    .calendar-table td:first-child {
      width: 60px;
    }

    .calendar-table tr:last-child td {
      border-bottom: none;
    }

    .calendar-table td:last-child,
    .calendar-table th:last-child {
      border-right: none;
    }

    .calendar-table tbody tr:nth-child(odd) td:first-child {
      background: #090f20;
      font-weight: 600;
      color: var(--text-soft);
    }

    .day-cell {
      position: relative;
      height: 40px;
      cursor: default;
      transition: background 0.15s, box-shadow 0.15s, transform 0.05s;
    }

    .day-cell span.day-number {
      position: absolute;
      top: 6px;
      left: 6px;
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .day-cell.has-event {
      background: rgba(255, 122, 26, 0.14);
      box-shadow: inset 0 0 0 1px rgba(255, 122, 26, 0.45);
    }

    .day-cell.has-event:hover {
      background: rgba(255, 122, 26, 0.2);
      transform: translateY(-1px);
    }

    .day-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent-soft);
    }

    .day-dot.feriado {
      background: var(--feriado);
    }

    .day-cell.empty {
      background: #050814;
      box-shadow: none;
      cursor: default;
    }

    /* Calendário anual: grade 6 x 2 */
    .year-grid {
      margin-top: 8px;
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
    }

    .mini-month {
      background: #050814;
      border-radius: 12px;
      padding: 8px;
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.02);
    }

    .mini-month-title {
      text-align: center;
      font-size: 0.8rem;
      margin-bottom: 4px;
      color: var(--text-soft);
    }

    .mini-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.65rem;
    }

    .mini-table thead {
      background: var(--accent);
      color: #1b1208;
    }

    .mini-table th,
    .mini-table td {
      text-align: center;
      padding: 3px;
      border-bottom: 1px solid var(--border-soft);
      border-right: 1px solid var(--border-soft);
    }

    .mini-table tr:last-child td {
      border-bottom: none;
    }

    .mini-table th:last-child,
    .mini-table td:last-child {
      border-right: none;
    }

    .mini-day {
      position: relative;
      height: 22px;
    }

    .mini-day span {
      font-size: 0.65rem;
    }

    .mini-day.has-event {
      background: rgba(255, 122, 26, 0.15);
      box-shadow: inset 0 0 0 1px rgba(255, 122, 26, 0.4);
    }

    .mini-dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      position: absolute;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent-soft);
    }

    .mini-dot.feriado {
      background: var(--feriado);
    }

    /* Legenda */
    .legend {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      font-size: 0.8rem;
      color: var(--text-soft);
      align-items: center;
    }

    .legend-title {
      font-weight: 600;
      color: var(--text);
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
    }

    .legend-dot.feriado {
      background: var(--feriado);
    }

    .legend-dot.evento {
      background: var(--accent-soft);
    }

    @media (max-width: 1024px) {
      .year-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 768px) {
      .card {
        padding: 18px 14px 14px;
      }

      .card-header {
        align-items: flex-start;
      }

      .year-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .calendar-table th,
      .calendar-table td {
        padding: 6px;
      }

      .day-cell {
        height: 36px;
      }
    }

    @media (max-width: 520px) {
      .year-grid {
        grid-template-columns: repeat(1, 1fr);
      }

      .controls {
        width: 100%;
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="card">
      <div class="card-header">
        <div class="title-block">
          <h1>Calendário Corporativo</h1>
          <p>Visão mensal ou anual, com feriados em cinza e eventos da empresa.</p>
        </div>

        <div class="controls">
          <div>
            <label for="modoVisualizacao">Visualizar:</label>
            <select id="modoVisualizacao">
              <option value="mensal">Mensal</option>
              <option value="anual">Anual</option>
            </select>
          </div>

          <div id="selectMesWrapper">
            <label for="selectMes">Mês:</label>
            <select id="selectMes"></select>
          </div>

          <div>
            <label for="selectAno">Ano:</label>
            <select id="selectAno"></select>
          </div>
        </div>
      </div>

      <!-- Navegação do mês para a visão mensal -->
      <div class="month-nav" id="monthNav">
        <button id="btnPrev">&lt;</button>
        <span id="labelMesAno"></span>
        <button id="btnNext">&gt;</button>
      </div>

      <!-- Calendário mensal -->
      <table class="calendar-table" id="tabelaMensal"></table>

      <!-- Calendário anual -->
      <div id="gradeAnual" style="display:none;">
        <div class="year-grid" id="yearGrid"></div>
      </div>

      <!-- Legenda -->
      <div class="legend">
        <span class="legend-title">Legenda de eventos</span>
        <span class="legend-item"><span class="legend-dot feriado"></span>Feriado nacional</span>
        <span class="legend-item"><span class="legend-dot evento"></span>Evento cadastrado</span>
      </div>
    </div>
  </div>

  <script>
    // === CONFIGURAÇÕES ===
    const URL_BASE = "https://agenda-areia-ana-default-rtdb.firebaseio.com/eventos.json";

    const mesesNomes = [
      "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
      "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
    ];

    // Feriados fixos (Brasil) - só para exemplo
    const feriadosFixos = [
      { mes: 1,  dia: 1,  titulo: "Confraternização Universal" },
      { mes: 4,  dia: 21, titulo: "Tiradentes" },
      { mes: 5,  dia: 1,  titulo: "Dia do Trabalhador" },
      { mes: 9,  dia: 7,  titulo: "Independência do Brasil" },
      { mes: 10, dia: 12, titulo: "Nossa Senhora Aparecida" },
      { mes: 11, dia: 2,  titulo: "Finados" },
      { mes: 11, dia: 15, titulo: "Proclamação da República" },
      { mes: 12, dia: 25, titulo: "Natal" }
    ];

    const selectModo = document.getElementById("modoVisualizacao");
    const selectMes = document.getElementById("selectMes");
    const selectAno = document.getElementById("selectAno");
    const tabelaMensal = document.getElementById("tabelaMensal");
    const gradeAnual = document.getElementById("gradeAnual");
    const yearGrid = document.getElementById("yearGrid");
    const monthNav = document.getElementById("monthNav");
    const labelMesAno = document.getElementById("labelMesAno");
    const btnPrev = document.getElementById("btnPrev");
    const btnNext = document.getElementById("btnNext");
    const selectMesWrapper = document.getElementById("selectMesWrapper");

    let anoAtual = new Date().getFullYear();
    let mesAtual = new Date().getMonth(); // 0-11
    let eventosCarregados = {}; // { id: { data, titulo, cor, tipoRecorrencia } }

    // === INICIALIZAÇÃO ===
    function popularSelects() {
      // Meses
      selectMes.innerHTML = "";
      mesesNomes.forEach((nome, idx) => {
        const opt = document.createElement("option");
        opt.value = idx;
        opt.textContent = nome;
        selectMes.appendChild(opt);
      });
      selectMes.value = mesAtual;

      // Anos (atual -2 até atual +3 para ter uma folga)
      selectAno.innerHTML = "";
      const anoBase = new Date().getFullYear();
      for (let a = anoBase - 2; a <= anoBase + 3; a++) {
        const opt = document.createElement("option");
        opt.value = a;
        opt.textContent = a;
        selectAno.appendChild(opt);
      }
      selectAno.value = anoAtual;
    }

    async function carregarEventos() {
      try {
        const resp = await fetch(URL_BASE);
        if (!resp.ok) return;
        const dados = await resp.json() || {};
        eventosCarregados = dados;
      } catch (e) {
        console.error("Erro ao carregar eventos do Firebase:", e);
        eventosCarregados = {};
      }
    }

    // Gera mapa { 'YYYY-MM-DD': [ { titulo, cor, feriado:bool } ] }
    function montarMapaEventos(ano) {
      const mapa = {};

      // Feriados fixos (só ano atual solicitado)
      feriadosFixos.forEach(f => {
        const dataStr = `${ano}-${String(f.mes).padStart(2,"0")}-${String(f.dia).padStart(2,"0")}`;
        if (!mapa[dataStr]) mapa[dataStr] = [];
        mapa[dataStr].push({
          titulo: f.titulo,
          cor: null,
          feriado: true
        });
      });

      // Eventos vindos do Firebase
      if (eventosCarregados) {
        Object.values(eventosCarregados).forEach(ev => {
          if (!ev || !ev.data) return;
          const baseDate = new Date(ev.data);
          if (isNaN(baseDate)) return;

          const tipo = ev.tipoRecorrencia || "unico";
          const titulo = ev.titulo || "Evento";
          const cor = ev.cor || "#ff7a1a";

          function adiciona(dateObj) {
            const y = dateObj.getFullYear();
            const m = dateObj.getMonth() + 1;
            const d = dateObj.getDate();
            if (y !== ano) return;
            const dataStr = `${y}-${String(m).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
            if (!mapa[dataStr]) mapa[dataStr] = [];
            mapa[dataStr].push({ titulo, cor, feriado: false });
          }

          if (tipo === "unico") {
            // Só naquele ano exato
            if (baseDate.getFullYear() === ano) {
              adiciona(baseDate);
            }
          } else if (tipo === "anual") {
            // Mesma data em todos os anos
            const d = baseDate.getDate();
            const m = baseDate.getMonth();
            adiciona(new Date(ano, m, d));
          } else if (tipo === "mensal") {
            // Todo mês no mesmo dia
            const diaMes = baseDate.getDate();
            for (let m = 0; m < 12; m++) {
              const dt = new Date(ano, m, diaMes);
              adiciona(dt);
            }
          } else if (tipo === "semanal") {
            // Toda semana a partir da data base
            let dt = new Date(baseDate);
            while (dt.getFullYear() <= ano + 1) {
              if (dt.getFullYear() === ano) adiciona(dt);
              dt.setDate(dt.getDate() + 7);
              if (dt.getFullYear() > ano && tipo === "semanal") break;
            }
          } else {
            // fallback = único
            if (baseDate.getFullYear() === ano) adiciona(baseDate);
          }
        });
      }

      return mapa;
    }

    // === RENDER MENSAL ===
    function desenharMensal(ano, mes) {
      const mapaEventos = montarMapaEventos(ano);

      labelMesAno.textContent = `${mesesNomes[mes]} ${ano}`;
      selectAno.value = ano;
      selectMes.value = mes;

      // Cabeçalho
      let html = `
        <thead>
          <tr>
            <th>Semana</th>
            <th>Seg</th>
            <th>Ter</th>
            <th>Qua</th>
            <th>Qui</th>
            <th>Sex</th>
            <th>Sáb</th>
            <th>Dom</th>
          </tr>
        </thead>
        <tbody>
      `;

      // Descobrir primeiro dia da grade (segunda-feira da semana que contém o dia 1)
      const primeiroDiaMes = new Date(ano, mes, 1);
      const diaSemana = (primeiroDiaMes.getDay() + 6) % 7; // segunda=0
      const inicioGrade = new Date(ano, mes, 1 - diaSemana);

      let dataCursor = new Date(inicioGrade);
      let semana = 1;

      for (let linha = 0; linha < 6; linha++) {
        html += `<tr><td>${semana}</td>`;
        semana++;

        for (let col = 0; col < 7; col++) {
          const y = dataCursor.getFullYear();
          const m = dataCursor.getMonth();
          const d = dataCursor.getDate();
          const dataStr = `${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;

          const eventosDia = mapaEventos[dataStr] || [];
          const dentroMes = (m === mes);

          if (!dentroMes) {
            html += `<td class="day-cell empty"></td>`;
          } else {
            const temEvento = eventosDia.length > 0;
            let classes = "day-cell";
            if (temEvento) classes += " has-event";

            html += `<td class="${classes}">`;
            html += `<span class="day-number">${d}</span>`;

            if (temEvento) {
              const temFeriado = eventosDia.some(e => e.feriado);
              html += `<div class="day-dot ${temFeriado ? "feriado" : ""}"></div>`;
            }

            html += `</td>`;
          }

          dataCursor.setDate(dataCursor.getDate() + 1);
        }

        html += `</tr>`;
      }

      html += `</tbody>`;
      tabelaMensal.innerHTML = html;
    }

    // === RENDER ANUAL ===
    function desenharAnual(ano) {
      const mapaEventos = montarMapaEventos(ano);
      yearGrid.innerHTML = "";

      for (let mes = 0; mes < 12; mes++) {
        const mini = document.createElement("div");
        mini.className = "mini-month";

        const titulo = document.createElement("div");
        titulo.className = "mini-month-title";
        titulo.textContent = mesesNomes[mes];
        mini.appendChild(titulo);

        let html = `
          <table class="mini-table">
            <thead>
              <tr>
                <th>S</th>
                <th>T</th>
                <th>Q</th>
                <th>Q</th>
                <th>S</th>
                <th>S</th>
                <th>D</th>
              </tr>
            </thead>
            <tbody>
        `;

        const primeiroDiaMes = new Date(ano, mes, 1);
        const diaSemana = (primeiroDiaMes.getDay() + 6) % 7; // segunda=0
        const inicioGrade = new Date(ano, mes, 1 - diaSemana);
        let cursor = new Date(inicioGrade);

        for (let linha = 0; linha < 6; linha++) {
          html += `<tr>`;
          for (let col = 0; col < 7; col++) {
            const y = cursor.getFullYear();
            const m = cursor.getMonth();
            const d = cursor.getDate();
            const dataStr = `${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;

            const eventosDia = mapaEventos[dataStr] || [];
            const dentroMes = (m === mes);

            if (!dentroMes) {
              html += `<td></td>`;
            } else {
              const temEvento = eventosDia.length > 0;
              let classes = "mini-day";
              if (temEvento) classes += " has-event";

              html += `<td class="${classes}"><span>${d}</span>`;
              if (temEvento) {
                const temFeriado = eventosDia.some(e => e.feriado);
                html += `<div class="mini-dot ${temFeriado ? "feriado" : ""}"></div>`;
              }
              html += `</td>`;
            }

            cursor.setDate(cursor.getDate() + 1);
          }
          html += `</tr>`;
        }

        html += `</tbody></table>`;
        mini.innerHTML += html;
        yearGrid.appendChild(mini);
      }
    }

    // === TROCA DE MODO ===
    function atualizarVisualizacao() {
      const modo = selectModo.value;
      anoAtual = parseInt(selectAno.value, 10);
      mesAtual = parseInt(selectMes.value, 10);

      if (modo === "mensal") {
        gradeAnual.style.display = "none";
        tabelaMensal.style.display = "";
        monthNav.style.display = "flex";
        selectMesWrapper.style.display = "inline-block";
        desenharMensal(anoAtual, mesAtual);
      } else {
        tabelaMensal.style.display = "none";
        gradeAnual.style.display = "block";
        monthNav.style.display = "none";
        selectMesWrapper.style.display = "none";
        desenharAnual(anoAtual);
      }
    }

    // === EVENTOS DE UI ===
    selectModo.addEventListener("change", atualizarVisualizacao);
    selectMes.addEventListener("change", () => {
      mesAtual = parseInt(selectMes.value, 10);
      atualizarVisualizacao();
    });
    selectAno.addEventListener("change", () => {
      anoAtual = parseInt(selectAno.value, 10);
      atualizarVisualizacao();
    });

    btnPrev.addEventListener("click", () => {
      mesAtual--;
      if (mesAtual < 0) {
        mesAtual = 11;
        anoAtual--;
      }
      atualizarVisualizacao();
    });

    btnNext.addEventListener("click", () => {
      mesAtual++;
      if (mesAtual > 11) {
        mesAtual = 0;
        anoAtual++;
      }
      atualizarVisualizacao();
    });

    // === START ===
    (async function init() {
      popularSelects();
      await carregarEventos();
      atualizarVisualizacao();
    })();
  </script>
</body>
</html>
