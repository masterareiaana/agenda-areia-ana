<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Calendário Corporativo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonte -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap">

  <style>
    :root {
      --bg: #050814;
      --bg-card: #0b1020;
      --bg-soft: #101629;
      --accent: #ff7a1a;
      --accent-soft: #ff9b4a;
      --text: #f5f7ff;
      --text-soft: #c2c7ff;
      --feriado: #666666;
      --border-soft: rgba(255, 255, 255, 0.06);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #151821 0, #050814 45%, #02030a 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 32px 16px;
    }

    .layout {
      width: 100%;
      max-width: 1280px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.04), transparent 40%);
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 24px 70px rgba(0, 0, 0, 0.7);
      padding: 24px 28px 32px;
    }

    .layout-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .layout-title-block h1 {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .layout-title-block p {
      font-size: 13px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .filters {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
      color: var(--text-soft);
    }

    .filter-group label {
      padding-left: 4px;
    }

    select {
      background: var(--bg-card);
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      color: var(--text);
      padding: 6px 32px 6px 12px;
      font-size: 13px;
      outline: none;
      cursor: pointer;
      position: relative;
      appearance: none;
    }

    .select-wrapper {
      position: relative;
      display: inline-block;
    }

    .select-wrapper::after {
      content: "▾";
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
      color: var(--text-soft);
      pointer-events: none;
    }

    /* CONTAINER PRINCIPAL DO CALENDÁRIO */
    .calendar-wrapper {
      margin-top: 10px;
      background: var(--bg-card);
      border-radius: 18px;
      padding: 20px 20px 18px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .calendar-header-inline {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .month-title {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .nav-btn {
      border-radius: 999px;
      background: var(--bg-soft);
      border: 1px solid transparent;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-soft);
      font-size: 14px;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.1s ease;
    }

    .nav-btn:hover {
      background: #171d33;
      border-color: rgba(255, 255, 255, 0.08);
      transform: translateY(-1px);
    }

    /* TABELA MENSAL */
    .calendar-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      font-size: 13px;
    }

    .calendar-table thead {
      background: var(--accent);
      color: #111;
    }

    .calendar-table th,
    .calendar-table td {
      border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 6px 4px 4px;
      text-align: center;
      vertical-align: top;
    }

    .calendar-table th {
      font-weight: 600;
    }

    .col-week {
      width: 60px;
    }

    .calendar-day {
      height: 52px;
      position: relative;
      cursor: pointer;
      background: transparent;
      transition: background 0.12s ease, box-shadow 0.12s ease;
    }

    .calendar-day.empty {
      cursor: default;
    }

    .calendar-day:hover:not(.empty) {
      background: rgba(255, 255, 255, 0.04);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
    }

    .day-number {
      font-size: 13px;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 3px;
    }

    .markers {
      position: absolute;
      left: 3px;
      right: 3px;
      bottom: 4px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .marker-bar {
      height: 3px;
      border-radius: 999px;
    }

    .marker-feriado {
      background: var(--feriado);
      opacity: 0.85;
    }

    .marker-evento {
      background: var(--accent-soft);
    }

    /* ANUAL */
    .calendar-annual-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 18px;
      margin-top: 6px;
    }

    .mini-month {
      background: var(--bg-soft);
      border-radius: 12px;
      padding: 10px 12px 12px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .mini-month-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      text-align: center;
    }

    .mini-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      font-size: 11px;
    }

    .mini-table th,
    .mini-table td {
      border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 4px 2px 2px;
      text-align: center;
      position: relative;
    }

    .mini-table thead {
      background: var(--accent);
      color: #111;
    }

    .mini-day {
      height: 32px;
      cursor: pointer;
    }

    .mini-day.empty {
      cursor: default;
    }

    .mini-day:hover:not(.empty) {
      background: rgba(255, 255, 255, 0.06);
    }

    .mini-markers {
      position: absolute;
      left: 2px;
      right: 2px;
      bottom: 2px;
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .mini-marker-bar {
      height: 2px;
      border-radius: 999px;
    }

    /* LEGENDA */
    .legend {
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px dashed rgba(255, 255, 255, 0.15);
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: var(--text-soft);
    }

    .legend-title {
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      font-size: 11px;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .legend-color {
      width: 16px;
      height: 4px;
      border-radius: 999px;
      background: var(--accent-soft);
    }

    /* MODAL DE DETALHES */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal {
      background: var(--bg-card);
      border-radius: 18px;
      padding: 18px 20px 16px;
      max-width: 420px;
      width: 100%;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .modal-title {
      font-size: 15px;
      font-weight: 600;
    }

    .modal-close {
      border: none;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
    }

    .modal-body {
      font-size: 13px;
      color: var(--text-soft);
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .event-item {
      padding: 6px 8px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.06);
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .event-label {
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .event-label span.color {
      width: 14px;
      height: 4px;
      border-radius: 999px;
      background: var(--accent-soft);
    }

    .event-type {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--text-soft);
    }

    .event-empty {
      font-size: 13px;
      color: var(--text-soft);
      text-align: center;
      padding: 10px 0 4px;
    }

    @media (max-width: 900px) {
      .calendar-annual-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 680px) {
      .layout {
        padding: 18px 16px 22px;
      }

      .layout-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .calendar-annual-grid {
        grid-template-columns: minmax(0, 1fr);
      }

      .calendar-table th,
      .calendar-table td {
        font-size: 11px;
        padding: 5px 2px 3px;
      }

      .calendar-day {
        height: 46px;
      }
    }
  </style>
</head>

<body>
  <main class="layout">
    <header class="layout-header">
      <div class="layout-title-block">
        <h1>Calendário Corporativo</h1>
        <p>Visão mensal ou anual, com feriados em cinza e eventos da empresa.</p>
      </div>

      <div class="filters">
        <div class="filter-group">
          <label for="viewMode">Visualizar:</label>
          <div class="select-wrapper">
            <select id="viewMode">
              <option value="mensal">Mensal</option>
              <option value="anual">Anual</option>
            </select>
          </div>
        </div>

        <div class="filter-group" id="monthWrapper">
          <label for="monthSelect">Mês:</label>
          <div class="select-wrapper">
            <select id="monthSelect"></select>
          </div>
        </div>

        <div class="filter-group">
          <label for="yearSelect">Ano:</label>
          <div class="select-wrapper">
            <select id="yearSelect"></select>
          </div>
        </div>
      </div>
    </header>

    <section class="calendar-wrapper">
      <!-- Cabeçalho do mês (apenas no mensal) -->
      <div id="monthHeader" class="calendar-header-inline">
        <button id="prevBtn" class="nav-btn" aria-label="Mês anterior">‹</button>
        <div class="month-title" id="monthTitle"></div>
        <button id="nextBtn" class="nav-btn" aria-label="Próximo mês">›</button>
      </div>

      <!-- Aqui entra o calendário (mensal ou anual) -->
      <div id="calendarContainer"></div>

      <!-- Legenda -->
      <div id="legend" class="legend"></div>
    </section>
  </main>

  <!-- Modal de detalhes -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle"></div>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <script>
    // ====== CONFIGURAÇÕES ======
    const URL_DB = "https://agenda-areia-ana-default-rtdb.firebaseio.com/eventos.json";

    const mesesNomes = [
      "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
      "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
    ];

    const diasSemanaCabecalho = ["Semana", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb", "Dom"];
    const diasSemanaMini = ["S", "T", "Q", "Q", "S", "S", "D"];

    let eventos = [];        // lista vinda do Firebase
    let eventosPorData = {}; // yyyy-mm-dd -> [eventos]
    let feriadosPorData = {}; // yyyy-mm-dd -> [{titulo, cor}]
    let legendaTipos = {};   // chave: label|cor -> {label, cor}

    let modoAtual = "mensal";
    let anoAtual = new Date().getFullYear();
    let mesAtual = new Date().getMonth();

    const viewModeEl = document.getElementById("viewMode");
    const monthSelectEl = document.getElementById("monthSelect");
    const yearSelectEl = document.getElementById("yearSelect");
    const monthWrapperEl = document.getElementById("monthWrapper");
    const monthTitleEl = document.getElementById("monthTitle");
    const calendarContainer = document.getElementById("calendarContainer");
    const legendEl = document.getElementById("legend");

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    const modalBackdrop = document.getElementById("modalBackdrop");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");
    const modalClose = document.getElementById("modalClose");

    // ====== FERiados fixos (Brasil) ======
    function gerarFeriadosParaAno(ano) {
      const fixos = [
        { mes: 0, dia: 1, titulo: "Confraternização Universal" },
        { mes: 3, dia: 21, titulo: "Tiradentes" },
        { mes: 4, dia: 1, titulo: "Dia do Trabalhador" },
        { mes: 8, dia: 7, titulo: "Independência do Brasil" },
        { mes: 9, dia: 12, titulo: "Nossa Senhora Aparecida" },
        { mes: 10, dia: 2, titulo: "Finados" },
        { mes: 10, dia: 15, titulo: "Proclamação da República" },
        { mes: 11, dia: 25, titulo: "Natal" }
      ];

      const map = {};
      fixos.forEach(f => {
        const d = `${ano}-${String(f.mes + 1).padStart(2, "0")}-${String(f.dia).padStart(2, "0")}`;
        map[d] = map[d] || [];
        map[d].push({ titulo: f.titulo, cor: "var(--feriado)" });
      });
      return map;
    }

    // ====== CARREGAR EVENTOS DO FIREBASE ======
    async function carregarEventos() {
      try {
        const resp = await fetch(URL_DB);
        const data = await resp.json();
        eventos = [];
        eventosPorData = {};

        if (data) {
          Object.keys(data).forEach(id => {
            const e = data[id];
            if (!e || !e.data || !e.titulo) return;
            const cor = e.cor || "#ff9b4a";
            const item = {
              id,
              data: e.data,
              titulo: e.titulo,
              cor
            };
            eventos.push(item);
            eventosPorData[item.data] = eventosPorData[item.data] || [];
            eventosPorData[item.data].push(item);
          });
        }
      } catch (err) {
        console.error("Erro ao carregar eventos:", err);
      }
    }

    // ====== LEGENDAS ======
    function montarLegenda() {
      legendaTipos = {};
      legendEl.innerHTML = "";

      // Feriado sempre entra
      legendaTipos["Feriado nacional|var(--feriado)"] = {
        label: "Feriado nacional",
        cor: "var(--feriado)"
      };

      // Eventos
      eventos.forEach(e => {
        const key = `${e.titulo}|${e.cor}`;
        if (!legendaTipos[key]) {
          legendaTipos[key] = { label: e.titulo, cor: e.cor };
        }
      });

      // Render
      const legendItems = Object.values(legendaTipos);

      if (!legendItems.length) return;

      legendEl.innerHTML = `
        <span class="legend-title">Legenda de eventos</span>
      `;

      legendItems.forEach(item => {
        const div = document.createElement("div");
        div.className = "legend-item";
        div.innerHTML = `
          <span class="legend-color" style="background:${item.cor};"></span>
          <span>${item.label}</span>
        `;
        legendEl.appendChild(div);
      });
    }

    // ====== RENDER MENSAL ======
    function renderMensal() {
      monthHeader.style.display = "flex";
      calendarContainer.innerHTML = "";

      const ano = anoAtual;
      const mes = mesAtual;

      // Título do mês
      monthTitleEl.textContent = `${mesesNomes[mes]} ${ano}`;

      const primeiroDiaSemana = new Date(ano, mes, 1).getDay(); // 0 = Domingo
      const ultimoDia = new Date(ano, mes + 1, 0).getDate();

      // Montar feriados pro ano atual
      feriadosPorData = gerarFeriadosParaAno(ano);

      // Table
      const table = document.createElement("table");
      table.className = "calendar-table";

      // Cabeçalho
      const thead = document.createElement("thead");
      const trHead = document.createElement("tr");
      diasSemanaCabecalho.forEach((nome, index) => {
        const th = document.createElement("th");
        th.textContent = nome;
        if (index === 0) th.classList.add("col-week");
        trHead.appendChild(th);
      });
      thead.appendChild(trHead);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");

      let dia = 1;
      let semana = 1;

      // Começar na segunda-feira
      // No JS, 0 = domingo, 1 = segunda...
      // Cabeçalho está: Semana, Seg, Ter, Qua, Qui, Sex, Sáb, Dom
      const offset = (primeiroDiaSemana + 6) % 7; // transforma domingo como 6

      for (let linha = 0; linha < 6; linha++) {
        const tr = document.createElement("tr");

        // Coluna "Semana"
        const tdSemana = document.createElement("td");
        tdSemana.textContent = semana;
        tr.appendChild(tdSemana);

        for (let col = 0; col < 7; col++) {
          const td = document.createElement("td");
          td.className = "calendar-day";

          const numeroCelula = linha * 7 + col;
          if (numeroCelula < offset || dia > ultimoDia) {
            td.classList.add("empty");
            tr.appendChild(td);
            continue;
          }

          const dataStr = `${ano}-${String(mes + 1).padStart(2, "0")}-${String(dia).padStart(2, "0")}`;

          const spanNum = document.createElement("div");
          spanNum.className = "day-number";
          spanNum.textContent = dia;

          const markers = document.createElement("div");
          markers.className = "markers";

          // Feriados
          if (feriadosPorData[dataStr]) {
            feriadosPorData[dataStr].forEach(f => {
              const mk = document.createElement("div");
              mk.className = "marker-bar marker-feriado";
              mk.style.background = "var(--feriado)";
              markers.appendChild(mk);
            });
          }

          // Eventos cadastrados
          if (eventosPorData[dataStr]) {
            eventosPorData[dataStr].forEach(e => {
              const mk = document.createElement("div");
              mk.className = "marker-bar marker-evento";
              mk.style.background = e.cor || "var(--accent-soft)";
              markers.appendChild(mk);
            });
          }

          td.appendChild(spanNum);
          if (markers.children.length) {
            td.appendChild(markers);
          }

          // Guardar a data na célula
          td.dataset.date = dataStr;

          tr.appendChild(td);
          dia++;
        }

        tbody.appendChild(tr);
        semana++;
        if (dia > ultimoDia) break;
      }

      table.appendChild(tbody);
      calendarContainer.appendChild(table);
    }

    // ====== RENDER ANUAL ======
    function renderAnual() {
      monthHeader.style.display = "none";
      calendarContainer.innerHTML = "";

      const ano = anoAtual;
      feriadosPorData = gerarFeriadosParaAno(ano);

      const grid = document.createElement("div");
      grid.className = "calendar-annual-grid";

      for (let mes = 0; mes < 12; mes++) {
        const mini = document.createElement("div");
        mini.className = "mini-month";

        const title = document.createElement("div");
        title.className = "mini-month-title";
        title.textContent = mesesNomes[mes];
        mini.appendChild(title);

        const table = document.createElement("table");
        table.className = "mini-table";

        // head
        const thead = document.createElement("thead");
        const trHead = document.createElement("tr");
        diasSemanaMini.forEach(d => {
          const th = document.createElement("th");
          th.textContent = d;
          trHead.appendChild(th);
        });
        thead.appendChild(trHead);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        const primeiroDiaSemana = new Date(ano, mes, 1).getDay();
        const ultimoDia = new Date(ano, mes + 1, 0).getDate();
        const offset = (primeiroDiaSemana + 6) % 7;

        let dia = 1;
        for (let linha = 0; linha < 6; linha++) {
          const tr = document.createElement("tr");
          for (let col = 0; col < 7; col++) {
            const td = document.createElement("td");
            td.className = "mini-day";

            const numeroCelula = linha * 7 + col;
            if (numeroCelula < offset || dia > ultimoDia) {
              td.classList.add("empty");
              tr.appendChild(td);
              continue;
            }

            const dataStr = `${ano}-${String(mes + 1).padStart(2, "0")}-${String(dia).padStart(2, "0")}`;

            td.textContent = dia;

            const markers = document.createElement("div");
            markers.className = "mini-markers";

            if (feriadosPorData[dataStr]) {
              feriadosPorData[dataStr].forEach(() => {
                const mk = document.createElement("div");
                mk.className = "mini-marker-bar";
                mk.style.background = "var(--feriado)";
                markers.appendChild(mk);
              });
            }

            if (eventosPorData[dataStr]) {
              eventosPorData[dataStr].forEach(e => {
                const mk = document.createElement("div");
                mk.className = "mini-marker-bar";
                mk.style.background = e.cor || "var(--accent-soft)";
                markers.appendChild(mk);
              });
            }

            if (markers.children.length) td.appendChild(markers);

            td.dataset.date = dataStr;
            tr.appendChild(td);
            dia++;
          }
          tbody.appendChild(tr);
          if (dia > ultimoDia) break;
        }

        table.appendChild(tbody);
        mini.appendChild(table);
        grid.appendChild(mini);
      }

      calendarContainer.appendChild(grid);
    }

    // ====== MODAL DETALHES ======
    function abrirModal(dateStr) {
      const [ano, mes, dia] = dateStr.split("-");
      const dataLabel = `${String(dia).padStart(2, "0")}/${String(mes).padStart(2, "0")}/${ano}`;
      modalTitle.textContent = `Eventos em ${dataLabel}`;
      modalBody.innerHTML = "";

      const lista = [];

      if (feriadosPorData[dateStr]) {
        feriadosPorData[dateStr].forEach(f => {
          lista.push({
            tipo: "Feriado",
            titulo: f.titulo,
            cor: "var(--feriado)"
          });
        });
      }

      if (eventosPorData[dateStr]) {
        eventosPorData[dateStr].forEach(e => {
          lista.push({
            tipo: "Evento",
            titulo: e.titulo,
            cor: e.cor || "var(--accent-soft)"
          });
        });
      }

      if (!lista.length) {
        const div = document.createElement("div");
        div.className = "event-empty";
        div.textContent = "Nenhum evento para esta data.";
        modalBody.appendChild(div);
      } else {
        lista.forEach(item => {
          const div = document.createElement("div");
          div.className = "event-item";
          div.innerHTML = `
            <div class="event-label">
              <span class="color" style="background:${item.cor};"></span>
              <span>${item.titulo}</span>
            </div>
            <span class="event-type">${item.tipo}</span>
          `;
          modalBody.appendChild(div);
        });
      }

      modalBackdrop.style.display = "flex";
    }

    function fecharModal() {
      modalBackdrop.style.display = "none";
    }

    // ====== EVENTOS DE CLIQUE ======
    calendarContainer.addEventListener("click", (ev) => {
      const cell = ev.target.closest(".calendar-day, .mini-day");
      if (!cell || cell.classList.contains("empty")) return;
      const dateStr = cell.dataset.date;
      if (!dateStr) return;
      abrirModal(dateStr);
    });

    modalClose.addEventListener("click", fecharModal);
    modalBackdrop.addEventListener("click", (ev) => {
      if (ev.target === modalBackdrop) fecharModal();
    });

    // ====== CONTROLES / SELECTS ======
    viewModeEl.addEventListener("change", () => {
      modoAtual = viewModeEl.value;
      monthWrapperEl.style.display = modoAtual === "mensal" ? "flex" : "none";
      renderizar();
    });

    monthSelectEl.addEventListener("change", () => {
      mesAtual = Number(monthSelectEl.value);
      renderizar();
    });

    yearSelectEl.addEventListener("change", () => {
      anoAtual = Number(yearSelectEl.value);
      renderizar();
    });

    prevBtn.addEventListener("click", () => {
      if (modoAtual !== "mensal") return;
      mesAtual--;
      if (mesAtual < 0) {
        mesAtual = 11;
        anoAtual--;
      }
      yearSelectEl.value = anoAtual;
      monthSelectEl.value = mesAtual;
      renderMensal();
    });

    nextBtn.addEventListener("click", () => {
      if (modoAtual !== "mensal") return;
      mesAtual++;
      if (mesAtual > 11) {
        mesAtual = 0;
        anoAtual++;
      }
      yearSelectEl.value = anoAtual;
      monthSelectEl.value = mesAtual;
      renderMensal();
    });

    // ====== RENDER GERAL ======
    function renderizar() {
      if (modoAtual === "mensal") {
        renderMensal();
      } else {
        renderAnual();
      }
      montarLegenda();
    }

    // ====== INICIALIZAÇÃO ======
    function popularSelects() {
      // anos (atual -2 até atual +2, por exemplo)
      yearSelectEl.innerHTML = "";
      const anoBase = new Date().getFullYear();
      for (let a = anoBase - 2; a <= anoBase + 3; a++) {
        const opt = document.createElement("option");
        opt.value = a;
        opt.textContent = a;
        if (a === anoAtual) opt.selected = true;
        yearSelectEl.appendChild(opt);
      }

      // meses
      monthSelectEl.innerHTML = "";
      mesesNomes.forEach((nome, idx) => {
        const opt = document.createElement("option");
        opt.value = idx;
        opt.textContent = nome;
        if (idx === mesAtual) opt.selected = true;
        monthSelectEl.appendChild(opt);
      });
    }

    async function init() {
      popularSelects();
      await carregarEventos();
      renderizar();
    }

    init();
  </script>
</body>
</html>
