<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Admin ‚Äì Calend√°rio Areia Ana</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #050814;
      --card: #0b1020;
      --card-soft: #101629;
      --accent: #ff7a1a;
      --accent-soft: #ff9b4a;
      --text: #f5f7ff;
      --text-soft: #c2c7ff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #151821 0, #050814 45%, #02030a 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .wrap {
      background: var(--card);
      border-radius: 16px;
      padding: 32px 24px;
      max-width: 720px;
      width: 100%;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.6);
    }

    h1 {
      margin: 0 0 8px;
      text-align: center;
      font-size: 24px;
    }

    .sub {
      text-align: center;
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 24px;
    }

    label {
      font-size: 13px;
      color: var(--text-soft);
      display: block;
      margin-bottom: 4px;
    }

    input[type="password"],
    input[type="date"],
    input[type="text"],
    input[type="color"],
    select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #1b2238;
      background: var(--card-soft);
      color: var(--text);
      font-size: 14px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s;
    }

    input:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(255, 122, 26, 0.3);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 12px;
    }

    .field {
      margin-bottom: 14px;
    }

    .btn-main {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 12px 18px;
      margin-top: 8px;
      background: var(--accent);
      color: #000;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.15s, transform 0.05s;
    }

    .btn-main:hover {
      background: var(--accent-soft);
    }

    .btn-main:active {
      transform: scale(0.98);
    }

    .hint {
      margin-top: 16px;
      font-size: 12px;
      color: var(--text-soft);
      line-height: 1.5;
    }

    /* Tabela de eventos */
    h2 {
      margin-top: 28px;
      font-size: 18px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 13px;
    }

    thead {
      background: #080d1d;
    }

    th, td {
      padding: 8px 6px;
      text-align: left;
      border-bottom: 1px solid #1b2238;
    }

    th {
      font-weight: 500;
      color: var(--text-soft);
    }

    tr:hover td {
      background: rgba(255, 255, 255, 0.02);
    }

    .cor-preview {
      display: inline-block;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid #22293e;
    }

    .actions button {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      margin-right: 4px;
    }

    .btn-edit {
      background: #2f82ff;
      color: #fff;
    }

    .btn-del {
      background: #ff4b4b;
      color: #fff;
    }

    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #151b2e;
      color: var(--text-soft);
    }

    @media (max-width: 640px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
      .wrap {
        padding: 24px 18px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Admin ‚Äì Calend√°rio</h1>
    <p class="sub">
      S√≥ quem tem a senha consegue incluir, editar ou excluir eventos.
      As atualiza√ß√µes aparecem automaticamente para os usu√°rios.
    </p>

    <form id="form-admin">
      <div class="field">
        <label>Senha de administrador:</label>
        <input type="password" id="senha" autocomplete="off" />
      </div>

      <div class="field">
        <label>Data de refer√™ncia do evento:</label>
        <input type="date" id="data" />
      </div>

      <div class="field">
        <label>T√≠tulo do evento:</label>
        <input type="text" id="titulo" placeholder="Ex.: Reuni√£o de Alinhamento" />
      </div>

      <div class="field">
        <label>Repeti√ß√£o:</label>
        <select id="repeticao">
          <option value="unico">Evento √∫nico (s√≥ neste dia)</option>
          <option value="mensal">Todo m√™s neste dia (ex.: todo dia 20)</option>
          <option value="semanal">Toda semana neste dia da semana</option>
        </select>
      </div>

      <div class="field grid-2">
        <div>
          <label>Cor do evento:</label>
          <input type="color" id="cor" value="#ff7a1a" />
        </div>
      </div>

      <button type="submit" class="btn-main" id="btn-salvar">Incluir evento</button>

      <p class="hint">
        üí° Dica: escolha cores fixas por tipo de evento (reuni√µes, treinamentos, campanhas etc.).
        Os feriados j√° aparecem em cinza escuro automaticamente.
      </p>
    </form>

    <h2>Eventos cadastrados</h2>
    <p class="hint">
      Aqui voc√™ consegue ver tudo o que est√° configurado, editar ou apagar algum evento.
      Se apagar um evento recorrente, ele some de todas as datas correspondentes no calend√°rio.
    </p>

    <table>
      <thead>
        <tr>
          <th>T√≠tulo</th>
          <th>Recorr√™ncia</th>
          <th>Data base</th>
          <th>Cor</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody id="lista-eventos"></tbody>
    </table>
  </div>

  <script>
    // üîó URL do Realtime Database
    const URL_DB = "https://agenda-areia-ana-default-rtdb.firebaseio.com";
    // üîí Senha do admin
    const SENHA = "areia2025";

    let eventosCache = {};   // { id: evento }
    let idEditando = null;   // se estiver preenchido, estamos editando

    // Helpers
    function formatarDataBr(iso) {
      if (!iso) return "-";
      const [y, m, d] = iso.split("-");
      return `${d}/${m}/${y}`;
    }

    function nomeDiaSemana(idx) {
      const nomes = ["domingo", "segunda", "ter√ßa", "quarta", "quinta", "sexta", "s√°bado"];
      return nomes[idx] || "";
    }

    function descricaoRecorrencia(ev) {
      if (!ev || !ev.tipo) return "-";
      switch (ev.tipo) {
        case "unico":
          return "Evento √∫nico";
        case "mensal":
          return `Todo m√™s no dia ${ev.diaMes}`;
        case "semanal":
          return `Toda ${nomeDiaSemana(ev.diaSemana)}`;
        default:
          return ev.tipo;
      }
    }

    // Renderizar tabela
    function renderizarTabela() {
      const corpo = document.getElementById("lista-eventos");
      corpo.innerHTML = "";

      if (!eventosCache) return;

      Object.entries(eventosCache).forEach(([id, ev]) => {
        if (!ev) return;

        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${ev.titulo || "-"}</td>
          <td><span class="tag">${descricaoRecorrencia(ev)}</span></td>
          <td>${formatarDataBr(ev.data)}</td>
          <td><span class="cor-preview" style="background:${ev.cor || "#ff7a1a"}"></span></td>
          <td class="actions">
            <button class="btn-edit" type="button" onclick="editarEvento('${id}')">Editar</button>
            <button class="btn-del" type="button" onclick="excluirEvento('${id}')">Excluir</button>
          </td>
        `;

        corpo.appendChild(tr);
      });
    }

    // Carregar eventos do Firebase
    async function carregarEventos() {
      try {
        const resp = await fetch(`${URL_DB}/eventos.json`);
        const dados = await resp.json();
        eventosCache = dados || {};
        renderizarTabela();
      } catch (err) {
        console.error(err);
        alert("Erro ao carregar eventos. Tente recarregar a p√°gina.");
      }
    }

    // Salvar (criar ou atualizar)
    document.getElementById("form-admin").addEventListener("submit", async (e) => {
      e.preventDefault();

      const senha = document.getElementById("senha").value.trim();
      if (senha !== SENHA) {
        alert("Senha incorreta.");
        return;
      }

      const data = document.getElementById("data").value;
      const titulo = document.getElementById("titulo").value.trim();
      const repeticao = document.getElementById("repeticao").value;
      const cor = document.getElementById("cor").value || "#ff7a1a";

      if (!data) {
        alert("Informe a data base do evento.");
        return;
      }
      if (!titulo) {
        alert("Informe o t√≠tulo do evento.");
        return;
      }

      const dt = new Date(data + "T00:00:00");
      const diaMes = dt.getDate();
      const diaSemana = dt.getDay();

      const payload = {
        titulo,
        tipo: repeticao,   // "unico" | "mensal" | "semanal"
        data,
        diaMes,
        diaSemana,
        cor
      };

      try {
        let url = `${URL_DB}/eventos.json`;
        let method = "POST";

        if (idEditando) {
          url = `${URL_DB}/eventos/${idEditando}.json`;
          method = "PATCH";
        }

        const resp = await fetch(url, {
          method,
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!resp.ok) throw new Error("Erro HTTP " + resp.status);

        if (!idEditando) {
          const resJson = await resp.json();
          const novoId = resJson.name;
          eventosCache[novoId] = payload;
        } else {
          eventosCache[idEditando] = payload;
          idEditando = null;
          document.getElementById("btn-salvar").textContent = "Incluir evento";
        }

        document.getElementById("data").value = "";
        document.getElementById("titulo").value = "";
        document.getElementById("repeticao").value = "unico";
        document.getElementById("cor").value = "#ff7a1a";

        renderizarTabela();
        alert("Evento salvo com sucesso!");
      } catch (err) {
        console.error(err);
        alert("Erro ao salvar evento.");
      }
    });

    // Editar
    window.editarEvento = function (id) {
      const ev = eventosCache[id];
      if (!ev) return;

      idEditando = id;
      document.getElementById("data").value = ev.data || "";
      document.getElementById("titulo").value = ev.titulo || "";
      document.getElementById("repeticao").value = ev.tipo || "unico";
      document.getElementById("cor").value = ev.cor || "#ff7a1a";

      document.getElementById("btn-salvar").textContent = "Salvar altera√ß√µes";
      window.scrollTo({ top: 0, behavior: "smooth" });
    };

    // Excluir
    window.excluirEvento = async function (id) {
      const ev = eventosCache[id];
      const nome = ev?.titulo || "este evento";

      if (!confirm(`Tem certeza que deseja excluir ${nome}?`)) return;

      try {
        const resp = await fetch(`${URL_DB}/eventos/${id}.json`, {
          method: "DELETE"
        });
        if (!resp.ok) throw new Error("Erro ao excluir");

        delete eventosCache[id];
        renderizarTabela();
      } catch (err) {
        console.error(err);
        alert("Erro ao excluir evento.");
      }
    };

    // Carrega tudo ao abrir
    carregarEventos();
  </script>
</body>
</html>
